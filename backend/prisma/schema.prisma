// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// ====================================================================
// 1. CONFIGURAÇÃO DO BANCO DE DADOS (PostgreSQL)
// Este bloco 'datasource db' substitui qualquer outro bloco anterior.
// ====================================================================
datasource db {
  provider = "postgresql" // Corrigido para PostgreSQL
  url      = env("DATABASE_URL")
}

// ====================================================================
// 2. CONFIGURAÇÃO DO GERADOR DE CLIENTE (Necessário para resolver o erro final)
// ====================================================================
generator client {
  provider = "prisma-client-js"
}


// ====================================================================
// 3. MODELOS (IDS MANTIDOS COMO UUIDs)
// ====================================================================

model Usuario {
  id               String        @id @default(uuid())
  name             String
  email            String        @unique
  password         String
  isOrganizador    Boolean       @default(false)
  
  // Relacionamentos
  eventosCriados   Evento[]
  inscricoes       Inscricao[]
  certificados     Certificado[]
}

model Evento {
  id               String        @id @default(uuid())
  titulo           String
  descricao        String?
  dataHora         DateTime
  local            String
  capacidadeMax    Int
  
  // Relacionamento com o criador (Organizador)
  organizadorId    String
  organizador      Usuario       @relation(fields: [organizadorId], references: [id])
  
  // Relacionamentos com Inscrições
  inscricoes       Inscricao[]
}

model Inscricao {
  id               String        @id @default(uuid())
  dataInscricao    DateTime      @default(now())
  status           String        @default("PENDENTE") // PENDENTE, CONFIRMADO, CANCELADO
  
  // Relacionamento com o Usuário
  usuarioId        String
  usuario          Usuario       @relation(fields: [usuarioId], references: [id])
  
  // Relacionamento com o Evento
  eventoId         String
  evento           Evento        @relation(fields: [eventoId], references: [id])
  
  @@unique([usuarioId, eventoId]) // Garante que um usuário só se inscreva uma vez por evento
}

model Certificado {
  id               String        @id @default(uuid())
  codigoValidacao  String        @unique
  dataEmissao      DateTime      @default(now())
  
  // Relacionamento com o Usuário (Participante)
  usuarioId        String
  usuario          Usuario       @relation(fields: [usuarioId], references: [id])
}